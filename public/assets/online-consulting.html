<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ì „ê¸°ì•ˆì „Â·í”¼í¬ì „ë ¥Â·ìš”ê¸ˆ ì„¤ë¬¸ â€“ ì»¨ì„¤íŒ… í¼ + ë¦¬ìŠ¤íŠ¸/ë‚´ë³´ë‚´ê¸°/ê¶Œí•œ</title>
<style>
:root{--brand:#d61f26;--ink:#0b1220;--brand-soft:#fee2e2}
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:#f7f9fc;color:#0b1220}
/* ê³µí†µ ì»¨í…Œì´ë„ˆ */
.survey-wrap{max-width:1200px;margin:16px auto;padding:12px;background:#fff;border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.08)}
/* ìƒë‹¨ ë°°ë„ˆ */
.survey-banner{position:sticky;top:0;z-index:1000;display:flex;align-items:center;gap:10px;justify-content:center;padding:10px 14px;background:rgba(255,255,255,.95);border-bottom:1px solid #e8eef6;font-weight:800}
.free-badge{display:inline-block;padding:4px 10px;border-radius:999px;background:#d61f26;color:#fff;font-weight:800}
/* ë²„íŠ¼ */
.btn{background:var(--brand);border:1px solid var(--brand);color:#fff;padding:8px 14px;border-radius:10px;font-weight:600;cursor:pointer}
.btn.secondary{background:#fff;color:#0f172a;border-color:#e5e7eb}
.btn[disabled]{opacity:.6;cursor:not-allowed}
/* ìƒë‹¨ íƒ­ */
.top-tabs{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:12px;flex-wrap:wrap}
.tabbar{display:flex;gap:8px}
.subtabs2{display:flex;gap:8px;flex-wrap:wrap}
.subtabs2 .subtab2{position:relative;padding:10px 16px;border-radius:14px;background:linear-gradient(180deg,#e53935,#c81d1d);border:2px solid #9f1b1b;color:#fff;font-weight:800}
.subtabs2 .subtab2.active{background:linear-gradient(180deg,#ef4444,#b91c1c);border-color:#7f1d1d}
.subtabs2 .mini{display:block;font-size:11px;opacity:.9;font-weight:700}
/* ì„¹ì…˜ íƒ€ì´í‹€ */
.sec-title{margin:18px 0 8px;padding:8px 12px;border-left:6px solid var(--brand);background:linear-gradient(#ffffff,#fafcff);border-radius:10px;font-weight:900}
.sec-hint{margin:-4px 0 8px 14px;color:#475569;font-size:13px}
.question{padding:10px 12px;margin:8px 0;border-radius:10px;border:1px solid #eef2f7;background:#fff}
.question legend{font-weight:800;margin-bottom:6px}
.badge-hint{display:inline-block;margin-left:6px;padding:2px 6px;border-radius:999px;border:1px solid #fecaca;background:var(--brand-soft);font-size:12px;color:#7f1d1d}
/* ë¦¬ìŠ¤íŠ¸ */
.search_area{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
#tbl_list{background:#fff;border-collapse:collapse;width:100%;border:1px solid #e5e7eb;font-size:14px}
#tbl_list thead th{position:sticky;top:0;background:#f3f6fb;color:#0f172a;border-bottom:1px solid #e5e7eb;padding:8px;z-index:1}
#tbl_list td{border-top:1px solid #f0f2f6;padding:8px}
/* ëª¨ë‹¬ */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:3000}
.modal{background:#fff;padding:20px;border-radius:12px;max-width:420px;box-shadow:0 10px 30px rgba(0,0,0,0.3);text-align:center}
.modal h3{margin-top:0;color:#b91c1c}
/* === Dark Mode === */
body[data-theme="dark"]{background:#0f172a;color:#e5e7eb}
body[data-theme="dark"] .survey-wrap{background:#111827;box-shadow:0 10px 30px rgba(0,0,0,.4)}
body[data-theme="dark"] .survey-banner{background:#111827;border-bottom-color:#1f2937}
body[data-theme="dark"] .btn.secondary{background:#1f2937;color:#e5e7eb;border-color:#374151}
body[data-theme="dark"] .question{background:#0b1320;border-color:#1f2937}
body[data-theme="dark"] #tbl_list{background:#0b1320;border-color:#1f2937}
body[data-theme="dark"] #tbl_list thead th{background:#0f172a;color:#e5e7eb;border-bottom-color:#1f2937}
body[data-theme="dark"] #tbl_list td{border-top-color:#1f2937}
body[data-theme="dark"] .badge-hint{background:#3f1d1d;border-color:#7f1d1d;color:#ffcccc}
</style>
</head>
<body>
  <div class="survey-banner">âš¡ <span>60ì´ˆ ì„¤ë¬¸ìœ¼ë¡œ ì „ê¸°ìš”ê¸ˆ ì ˆê°Â·ì•ˆì „ ê°œì„ ì— ë°”ë¡œ ë°˜ì˜ë©ë‹ˆë‹¤.</span> <span class="free-badge" style="margin-left:8px;">ì„¤ë¬¸ ì£¼ì‹œë©´ ë¬´ë£Œ ì»¨ì„¤íŒ…</span></div>
  <div class="survey-wrap">
    <div class="top-tabs">
      <button id="toggleDark" class="btn secondary" style="margin-left:auto" title="ë‹¤í¬ ëª¨ë“œ ì „í™˜">ğŸŒ“ Dark</button>
      <nav class="tabbar">
        <button class="btn tab" data-view="survey">ì„¤ë¬¸ì§€</button>
        <button class="btn tab" data-view="list">ì„¤ë¬¸ ë¦¬ìŠ¤íŠ¸</button>
      </nav>
      <div class="subtabs2" aria-label="ì„œë¸Œ íƒ­">
        <button type="button" class="btn subtab2" data-page="safety" title="ì•ˆì „ ìƒíƒœ ì ê²€">ğŸ›¡ï¸ ì „ê¸°ì•ˆì „ì ê²€ ì„¤ë¬¸ì¡°ì‚¬<span class="mini">Safety</span></button>
        <button type="button" class="btn subtab2 active" data-page="peak" title="í”¼í¬ì „ë ¥ ì»¨ì„¤íŒ…">âš¡ í”¼í¬ì „ë ¥ ì»¨ì„¤íŒ…<span class="mini">Peak</span></button>
        <button type="button" class="btn subtab2" data-page="saving" title="ìš”ê¸ˆì ˆê° ë¬´ë£Œ ì»¨ì„¤íŒ…">ğŸ’¡ ì „ê¸°ìš”ê¸ˆì ˆê° ë¬´ë£Œì»¨ì„¤íŒ…<span class="mini">Saving</span></button>
        <button type="button" class="btn subtab2" data-page="cases" title="ì ˆê°ì‚¬ë¡€ ë³´ê¸°">â­ ì ˆê°ì‚¬ë¡€ë³´ê¸°<span class="mini">Cases</span></button>
      </div>
    </div>

    <!-- ì„¤ë¬¸ì§€ í™”ë©´ -->
    <section id="view-survey" hidden>
      <form id="surveyForm">
        <div class="form-grid" style="display:grid; grid-template-columns:repeat(3,1fr); gap:12px; margin-bottom:12px;">
          <label>ê³ ê°ëª…<input name="cust" type="text" class="form-control" placeholder="(ì˜ˆ) í•œë¹›ë³‘ì›" required></label>
          <label>ì „í™”ë²ˆí˜¸<input name="phone" type="text" class="form-control" placeholder="010-0000-0000" required></label>
          <label>ì´ë©”ì¼<input name="email" type="email" class="form-control" placeholder="you@company.com" required></label>
        </div>

        <!-- ë¶„ë¦¬ í˜ì´ì§€: ì•ˆì „ / í”¼í¬ / ì ˆê° / ì‚¬ë¡€ -->
        <div id="page-safety" class="subpage" hidden>
          <div class="subview" id="sub-safe">
            <h2 class="sec-title">â¶ ì „ê¸°ì•ˆì „ì ê²€ ì„¤ë¬¸ì¡°ì‚¬(ì˜ˆê°€ 4ê°œ ì´í•˜ë©´ ì „ê¸°ì•ˆì „ ì†”ë£¨ì…” ë„ì…ìš”êµ¬)</h2>
            <div class="sec-hint">ê¸°ë³¸ ì•ˆì „ ìƒíƒœì™€ ìµœê·¼ ì´ìŠˆ ì—¬ë¶€ë¥¼ ê°„ë‹¨íˆ í™•ì¸í•©ë‹ˆë‹¤.</div>
            <fieldset class="question"><legend>ì „ê¸°ì•ˆì „ì ê²€ì„ í˜„ì¥ ì§ì ‘ ë°©ë¬¸í•˜ì—¬ ê³„ì¸¡í•˜ê³  ìˆë‚˜ìš”?<span class="badge-hint">ì˜ˆ: ì›” 1íšŒ ì •ê¸°ì ê²€</span></legend>
              <label><input type="radio" name="safe_visit_check" value="ì˜ˆ" required> ì˜ˆ</label>
              <label><input type="radio" name="safe_visit_check" value="ì•„ë‹ˆì˜¤"> ì•„ë‹ˆì˜¤</label>
            </fieldset>
            <fieldset class="question"><legend>ê·€ì‚¬ëŠ” ì „ê¸°ì•ˆì „ì ê²€ì„ ì›ê²©ìœ¼ë¡œ ìˆ˜í–‰í•˜ê³  ìˆë‚˜ìš”?<span class="badge-hint">ì˜ˆ: ëŒ€ì‹œë³´ë“œ 24/7 ëª¨ë‹ˆí„°ë§</span></legend>
              <label><input type="radio" name="safe_remote_check" value="ì˜ˆ" required> ì˜ˆ</label>
              <label><input type="radio" name="safe_remote_check" value="ì•„ë‹ˆì˜¤"> ì•„ë‹ˆì˜¤</label>
            </fieldset>
            <fieldset class="question"><legend>ê·€ì‚¬ëŠ” ì „ê¸°ì•ˆì „ì ê²€ì„ ì°¨ë‹¨ê¸°(ì„¤ë¹„)ë³„ë¡œ ëª¨ë‘ ì ê²€(ì¸¡ì •)í•˜ê³  ìˆë‚˜ìš”?<span class="badge-hint">ì˜ˆ: ì£¼ìš” ì„¤ë¹„ ë¼ì¸ í¬í•¨</span></legend>
              <label><input type="radio" name="safe_all_breakers_check" value="ì˜ˆ" required> ì˜ˆ</label>
              <label><input type="radio" name="safe_all_breakers_check" value="ì•„ë‹ˆì˜¤"> ì•„ë‹ˆì˜¤</label>
            </fieldset>
            <fieldset class="question"><legend>ì„¤ë¹„ ë‹´ë‹¹ìëŠ” ì°¨ë‹¨ê¸°ë³„ ì‹¤ì¸¡ ì „ë ¥ ë°ì´í„°ë¥¼ ìë™ìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ”ê°€ìš”?<span class="badge-hint">ì˜ˆ: ìµœê·¼ 1ê°œì›” ë‚´ ë¦¬í¬íŠ¸ ë³´ìœ </span></legend>
              <label><input type="radio" name="safe_measured_month" value="ì˜ˆ" required> ì˜ˆ</label>
              <label><input type="radio" name="safe_measured_month" value="ì•„ë‹ˆì˜¤"> ì•„ë‹ˆì˜¤</label>
            </fieldset>
            <fieldset class="question"><legend>ê·€ì‚¬ëŠ” ìµœê·¼ 3ê°œì›” ë‚´ ì°¨ë‹¨ê¸° íŠ¸ë¦½Â·ëˆ„ì „Â·ê³¼ì—´ ì´ìŠˆë¥¼ íŒŒì•…í•˜ê³  ìˆë‚˜ìš”?</legend>
              <label><input type="radio" name="safe_issue_trip" value="ì˜ˆ" required> ì˜ˆ</label>
              <label><input type="radio" name="safe_issue_trip" value="ì•„ë‹ˆì˜¤"> ì•„ë‹ˆì˜¤</label>
            </fieldset>
            <fieldset class="question"><legend>ê·€ì‚¬ëŠ” ìµœê·¼ 3ê°œì›” ë‚´ ê³¼ë¶€í•˜(ê³¼ì „ë¥˜) ì´ìŠˆë¥¼ íŒŒì•…í•˜ê³  ìˆë‚˜ìš”?<span class="badge-hint">ì˜ˆ: ì •ê²© ëŒ€ë¹„ ê³¼ë¶€í•˜ ì´ë²¤íŠ¸ ê¸°ë¡ ë³´ìœ </span></legend>
              <label><input type="radio" name="safe_issue_overload" value="ì˜ˆ" required> ì˜ˆ</label>
              <label><input type="radio" name="safe_issue_overload" value="ì•„ë‹ˆì˜¤"> ì•„ë‹ˆì˜¤</label>
            </fieldset>
            <fieldset class="question"><legend>ê·€ì‚¬ëŠ” ìµœê·¼ 3ê°œì›” ë‚´ ë¶ˆí‰í˜•(ì‚¼ìƒ ì–¸ë°¸ëŸ°ìŠ¤ %) ì´ìŠˆë¥¼ íŒŒì•…í•˜ê³  ìˆë‚˜ìš”?<span class="badge-hint">ì˜ˆ: ê¸°ì¤€ 3â€“5% ì´ˆê³¼ ì‹œ ì•Œë¦¼</span></legend>
              <label><input type="radio" name="safe_issue_unbalance" value="ì˜ˆ" required> ì˜ˆ</label>
              <label><input type="radio" name="safe_issue_unbalance" value="ì•„ë‹ˆì˜¤"> ì•„ë‹ˆì˜¤</label>
            </fieldset>
            <fieldset class="question"><legend>ê·€ì‚¬ëŠ” ìµœê·¼ 3ê°œì›” ë‚´ ê³ ì¡°íŒŒ(THD) ì´ìŠˆë¥¼ íŒŒì•…í•˜ê³  ìˆë‚˜ìš”?<span class="badge-hint">ì˜ˆ: THDâ€‘I 15% ì´ˆê³¼ ë“± ê¸°ì¤€</span></legend>
              <label><input type="radio" name="safe_issue_harmonics" value="ì˜ˆ" required> ì˜ˆ</label>
              <label><input type="radio" name="safe_issue_harmonics" value="ì•„ë‹ˆì˜¤"> ì•„ë‹ˆì˜¤</label>
            </fieldset>
          </div>
        </div>

        <div id="page-peak" class="subpage">
          <div class="subview" id="sub-save">
            <h2 class="sec-title">â¶ í”¼í¬ì „ë ¥ ì»¨ì„¤íŒ… <span class='badge-hint btn-link' onclick='openDetailModal()' style='font-size:13px;margin-left:10px;cursor:help;'>âš¡ ì •ë°€ì§„ë‹¨ì€ ìœ ë£Œë¡œ ì œê³µë©ë‹ˆë‹¤. (ìì„¸íˆ)</span></h2>
            <div class="sec-hint">í”¼í¬ ì‹œê°„ëŒ€ì™€ ë™ì‹œ ì‚¬ìš© íŒ¨í„´ì„ ì•Œì•„ì•¼ ì ˆê°ì²˜ë°©ì´ ì •í™•í•´ì§‘ë‹ˆë‹¤.</div>
            <fieldset class="question"><legend>ê·€ì‚¬ëŠ”  í”¼í¬ ì‹œê°„ëŒ€(ìš”ì¼/ì‹œê°„ëŒ€)ë¥¼ ì•Œê³  ê³„ì‹­ë‹ˆê¹Œ?</legend>
              <label><input type="radio" name="save_peak_known" value="ì˜ˆ" required> ì˜ˆ</label>
              <label><input type="radio" name="save_peak_known" value="ì•„ë‹ˆì˜¤"> ì•„ë‹ˆì˜¤</label>
            </fieldset>
            <fieldset class="question"><legend>ê·€ì‚¬ëŠ” ë™ì‹œ ì‚¬ìš©(ê²¹ì¹˜ëŠ”) ì„¤ë¹„ íŒ¨í„´ì„ ë¶„ì„í•´ ë³¸ ì ì´ ìˆìŠµë‹ˆê¹Œ?</legend>
              <label><input type="radio" name="save_simul_analysis" value="ì˜ˆ" required> ì˜ˆ</label>
              <label><input type="radio" name="save_simul_analysis" value="ì•„ë‹ˆì˜¤"> ì•„ë‹ˆì˜¤</label>
            </fieldset>
            <fieldset class="question"><legend>ê·€ì‚¬ëŠ” ì ˆê° ëª©í‘œ(%)ê°€ ìˆë‹¤ë©´ ì…ë ¥í•´ ì£¼ì„¸ìš”.</legend>
              <input type="number" min="0" max="100" step="1" name="save_goal_pct" placeholder="ì˜ˆ: 10" class="form-control" style="max-width:220px;">
            </fieldset>
            <fieldset class="question"><legend>ê·€ì‚¬ëŠ” í”¼í¬ì „ë ¥ ì •ë°€ì§„ë‹¨ ì¸¡ì •ì„ ì›í•˜ì‹œë‚˜ìš”? <span class="badge-hint">ìœ ë£Œì œê³µ</span></legend>
              <label><input type="radio" name="save_precise_diagnosis" value="ì˜ˆ"> ì˜ˆ</label>
              <label><input type="radio" name="save_precise_diagnosis" value="ì•„ë‹ˆì˜¤"> ì•„ë‹ˆì˜¤</label>
            </fieldset>
            <!-- ì •ë°€ì§„ë‹¨ ì•ˆë‚´ ëª¨ë‹¬ ìŠ¤í¬ë¦½íŠ¸ -->
            <script>
              function openDetailModal(){
                const modal=document.createElement('div');
                modal.className='modal-overlay';
                modal.innerHTML=`<div class="modal">
                    <h3>âš¡ ì •ë°€ì§„ë‹¨ ì„œë¹„ìŠ¤ ì•ˆë‚´</h3>
                    <p>ì „ë¬¸ ì¥ë¹„ë¥¼ í™œìš©í•œ ì‹¤ì‹œê°„ í”¼í¬ ì§„ë‹¨ ë° ë¶€í•˜ ë¶„ì„ì€ ìœ ë£Œë¡œ ì œê³µë©ë‹ˆë‹¤.<br>ì¸¡ì • ì¥ë¹„ ì„¤ì¹˜, ë¶„ì„, ë¦¬í¬íŠ¸ ì œê³µì´ í¬í•¨ë©ë‹ˆë‹¤.<br><br><strong>ë¬¸ì˜:</strong> 053-326-0114 / networkkorea.co.kr</p>
                    <button onclick="this.closest('.modal-overlay').remove()" class="btn secondary">ë‹«ê¸°</button>
                  </div>`;
                document.body.appendChild(modal);
              }
            </script>
          </div>
        </div>

        <div id="page-saving" class="subpage" hidden>
          <div class="subview" id="sub-bill">
            <h2 class="sec-title">â· ì „ê¸°ìš”ê¸ˆê³ ì§€ì„œ ë¶„ì„</h2>
            <div class="sec-hint">íŒŒì›Œí”Œë˜ë„ˆ ì œê³µ ë˜ëŠ” ê³ ì§€ì„œ ì œê³µ ì¤‘ í•œ ê°€ì§€ ë°©ì‹ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì „ë‹¬í•´ ì£¼ì„¸ìš”.</div>
            <fieldset class="question"><legend>(ì „ê¸°ìš”ê¸ˆê³ ì§€ì„œ ë¶„ì„): ë°ì´í„° ì œê³µ ë°©ì‹</legend>
              <label><input type="radio" name="collect_mode" value="planner" required checked> íŒŒì›Œí”Œë˜ë„ˆ IDÂ·ë¹„ë°€ë²ˆí˜¸ ì œê³µ</label>
              <label><input type="radio" name="collect_mode" value="bill"> ì „ê¸°ìš”ê¸ˆ ê³ ì§€ì„œ ì œê³µ</label>
              <p id="collect-summary" style="margin:8px 0 0; font-size:13px; font-weight:700;">í˜„ì¬ ì„ íƒ: íŒŒì›Œí”Œë˜ë„ˆ ì œê³µ</p>
            </fieldset>
            <div id="collect-planner" class="question" style="display:grid; grid-template-columns:repeat(3,1fr); gap:10px;">
              <label>íŒŒì›Œí”Œë˜ë„ˆ ID<input type="text" name="planner_id" class="form-control" placeholder="ì˜ˆ: hb_hospital" autocomplete="username"></label>
              <label>ì„ì‹œ ë¹„ë°€ë²ˆí˜¸<input type="password" name="planner_pw" class="form-control" placeholder="ì„ì‹œ ë¹„ë°€ë²ˆí˜¸" autocomplete="current-password"></label>
              <label style="display:flex; align-items:center; gap:8px;"><input type="checkbox" name="planner_consent" value="Y"> ë³´ì•ˆ ë™ì˜(ê²€í†  í›„ ì¦‰ì‹œ íŒŒê¸°)</label>
            </div>
            <fieldset class="question"><legend>(ì „ê¸°ìš”ê¸ˆê³ ì§€ì„œ ë¶„ì„): ë™ì˜</legend>
              <label style="display:flex;gap:8px;align-items:center"><input type="checkbox" name="consent_consult" value="Y" required> ì»¨ì„¤íŒ… ë™ì˜(ë¬´ìƒ ì§„ë‹¨ ë° ê²°ê³¼ ì•ˆë‚´ì— ë™ì˜í•©ë‹ˆë‹¤)</label>
              <label style="display:flex;gap:8px;align-items:center"><input type="checkbox" name="consent_privacy" value="Y" required> ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ ë™ì˜</label>
            </fieldset>
            <fieldset class="question"><legend>(ì „ê¸°ìš”ê¸ˆê³ ì§€ì„œ ë¶„ì„): ì›”ë Œíƒˆ ì˜µì…˜</legend>
              <label style="display:flex;gap:8px;align-items:center"><input type="checkbox" name="rent_want" value="Y"> ì›”ë Œíƒˆ ìƒë‹´ ì‹ ì²­ (ì„ íƒ)</label>
              <div class="sec-hint">ì „ê¸°ì ˆê°ìš”ê¸ˆìœ¼ë¡œ ì›”ë Œíƒˆí•˜ì„¸ìš”(ì¥ì¹˜ë‹¹/ì›”1ë§Œì›). <strong style="color:#b91c1c">(ì „ê¸°ì•ˆì „ì ê²€ì€ ì œì™¸)</strong></div>
            </fieldset>
            <div id="collect-bill" class="question" hidden>
              <label>ì „ê¸°ìš”ê¸ˆ ê³ ì§€ì„œ íŒŒì¼(ì•/ë’·ë©´)<input type="file" class="form-control" multiple></label>
            </div>
          </div>
        </div>

        <div id="page-cases" class="subpage" hidden>
          <div class="subview" id="sub-cases">
            <h2 class="sec-title">â¸ ì ˆê°ì‚¬ë¡€ë³´ê¸°</h2>
            <div class="sec-hint">ì‹¤ì œ ê³ ê°ì˜ ì „ê¸°ìš”ê¸ˆ ì ˆê° ì‚¬ë¡€ë¥¼ ìš”ì•½í–ˆìŠµë‹ˆë‹¤.</div>
            <div class="case-grid" style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;">
              <div class="question case-card" data-title="ë³‘ì› A" data-savings="ì›” 18% ì ˆê°" data-points="í”¼í¬ì œì–´, ì•¼ê°„ì ˆì „" data-notes="í”¼í¬ ì‹œê°„ëŒ€ ë¶„ì‚° ë° ì•¼ê°„ ë¹„í•„ìˆ˜ ë¶€í•˜ ì°¨ë‹¨" data-before="ì›” 1,100ë§Œì›" data-after="ì›” 902ë§Œì›">
                <legend>ë³‘ì› A</legend>
                <p>í”¼í¬ì œì–´+ì•¼ê°„ì ˆì „ìœ¼ë¡œ <b>ì›” 18%</b> ì ˆê°</p>
                <div><span class="badge-hint">ê³„ì•½ì „ë ¥ -10kW</span> <span class="badge-hint">ì •ë°€ì§„ë‹¨ O</span></div>
              </div>
              <div class="question case-card" data-title="ê³µì¥ B" data-savings="ì›” 12% ì ˆê°" data-points="ë™ì‹œì‚¬ìš© íŒ¨í„´ ìµœì í™”, í”¼í¬ë¶„ì‚°" data-notes="ìƒì‚° ë¼ì¸ êµëŒ€ ì‹œì  ì „í™˜ìœ¼ë¡œ í”¼í¬ ê²¹ì¹¨ í•´ì†Œ" data-before="ì›” 2,450ë§Œì›" data-after="ì›” 2,156ë§Œì›">
                <legend>ê³µì¥ B</legend>
                <p>ë™ì‹œì‚¬ìš© íŒ¨í„´ ìµœì í™”ë¡œ <b>ì›” 12%</b> ì ˆê°</p>
                <div><span class="badge-hint">íŒ¨í„´ê°œì„ </span> <span class="badge-hint">í”¼í¬ë¶„ì‚°</span></div>
              </div>
              <div class="question case-card" data-title="ìš”ì–‘ì› C" data-savings="ì›” 25% ì ˆê°" data-points="í”¼í¬ì „ë ¥ ì œì–´, ê³„ì•½ìš”ê¸ˆ ìµœì í™”" data-notes="ì¼ê³¼/ì•¼ê°„ ë¶€í•˜ ë¶„ë¦¬ ë° ë¶ˆí•„ìš” ë¶€í•˜ ìë™ ì°¨ë‹¨" data-before="ì›” 780ë§Œì›" data-after="ì›” 585ë§Œì›">
                <legend>ìš”ì–‘ì› C</legend>
                <p>í”¼í¬ì „ë ¥ë¡œ <b>ì›” 25%</b> ì ˆê°</p>
                <div><span class="badge-hint">ê³„ì•½ìš”ê¸ˆ ìµœì í™”</span> <span class="badge-hint">ì›ê²©ëª¨ë‹ˆí„°ë§</span></div>
              </div>
            </div>
          </div>
        </div>
          </div>
        </div>

        <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:10px;">
          <button type="submit" class="btn">ë¬´ë£Œ ì»¨ì„¤íŒ… ìš”ì²­ ì œì¶œ</button>
        </div>
      </form>
    </section>

    <!-- ë¦¬ìŠ¤íŠ¸ í™”ë©´ -->
    <section id="view-list" hidden>
      <div class="search_area">
        <strong>ê³ ê°ëª…</strong> <input id="f_cust" type="text" placeholder="ê²€ìƒ‰..."/>
        <strong style="margin-left:12px;">ì „í™”ë²ˆí˜¸</strong> <input id="f_phone" type="text" placeholder="ê²€ìƒ‰..."/>
        <button class="btn" id="btnFilter" style="margin-left:12px;">ê²€ìƒ‰</button>
        <div style="flex:1"></div>
        <span style="font-weight:600;">ì •ë ¬</span>
        <select id="sortOrder" class="form-control" style="min-width:160px;">
          <option value="ts_desc" selected>ìµœì‹  ì œì¶œ ìš°ì„ </option>
          <option value="ts_asc">ì˜¤ë˜ëœ ì œì¶œ ìš°ì„ </option>
          <option value="name_asc">ê³ ê°ëª… â†‘</option>
          <option value="name_desc">ê³ ê°ëª… â†“</option>
        </select>
        <label style="display:inline-flex;align-items:center;gap:6px;margin-left:10px;">
          <input type="checkbox" id="onlyPrecise"> ì •ë°€ì§„ë‹¨=ì˜ˆë§Œ
        </label>
        <button class="btn secondary" id="btnCsv" title="CSV ë‚´ë³´ë‚´ê¸°">CSV</button>
        <button class="btn secondary" id="btnXlsx" title="XLSX(ê°„í¸)">XLSX</button>
      </div>

      <div class="tbl_wrap">
        <table id="tbl_list">
          <thead>
            <tr>
              <th style="width:60px">No</th><th>ì œì¶œì¼ì‹œ</th><th>ê³ ê°ëª…</th><th>ì „í™”ë²ˆí˜¸</th><th>ì´ë©”ì¼</th><th>ìˆ˜ì§‘ID</th>
              <th>ì „ê¸°ì•ˆì „ì ê²€ ì„¤ë¬¸ì¡°ì‚¬</th><th>(í”¼í¬ì „ë ¥ ì»¨ì„¤íŒ…)</th><th>ë Œíƒˆí¬ë§</th><th>ìˆ˜ì§‘ë°©ì‹</th><th>(ì „ê¸°ìš”ê¸ˆê³ ì§€ì„œ ë¶„ì„)</th>
            </tr>
          </thead>
          <tbody id="tbody_list"></tbody>
        </table>
      </div>

      <div class="paging" id="paging"></div>
    </section>
  </div>

<script>
// ===== ë¼ìš°íŒ… & ê°€ë“œ =====
const views={survey:document.getElementById('view-survey'), list:document.getElementById('view-list')};
const tabBtns=document.querySelectorAll('.tabbar .tab');
function show(view){ Object.values(views).forEach(v=>{ if(v) v.hidden=true; }); if(views[view]) views[view].hidden=false; tabBtns.forEach(b=>b.classList.toggle('active', b.dataset.view===view)); location.hash=view; }
window.addEventListener('hashchange',()=>{ const v=(location.hash.replace('#','')||'survey'); show(v in views?v:'survey'); });
show((location.hash.replace('#',''))||'survey');

// ===== ì„œë¸Œ í˜ì´ì§€ íƒ­ =====
const pages={safety:document.getElementById('page-safety'), peak:document.getElementById('page-peak'), saving:document.getElementById('page-saving'), cases:document.getElementById('page-cases')};
const subBtns=document.querySelectorAll('.subtabs2 .subtab2');
function showPage(name){ Object.values(pages).forEach(p=>{ if(p) p.hidden=true; }); if(pages[name]) pages[name].hidden=false; subBtns.forEach(b=>b.classList.toggle('active', b.dataset.page===name)); }
subBtns.forEach(b=> b.addEventListener('click',()=> showPage(b.dataset.page)));
showPage('peak');

// ===== ì €ì¥/ë¡œë“œ/ë¦¬ìŠ¤íŠ¸ ë Œë” =====
const KEY='nk_survey_entries_v3_precise_filter';
const $form=document.getElementById('surveyForm');
const $tbody=document.getElementById('tbody_list');
const $paging=document.getElementById('paging');
function lsLoad(){ try{ return JSON.parse(localStorage.getItem(KEY))||[] }catch(e){ return [] } }
function lsSave(rows){ localStorage.setItem(KEY, JSON.stringify(rows)); }
function badge(txt){ return `<span style="padding:2px 8px;border-radius:10px;border:1px solid #e5e7eb;background:#fff;">${txt}</span>` }
async function loadAll(page=1,size=10,kw={}){ let rows=lsLoad().filter(r=> (!kw.cust||r.cust.includes(kw.cust)) && (!kw.phone||r.phone.includes(kw.phone)) ); const order=(document.getElementById('sortOrder')||{}).value||'ts_desc'; rows.forEach(r=>{ if(!('ts_epoch' in r)) r.ts_epoch=Date.parse(r.ts)||0; }); const cmp={ ts_desc:(a,b)=>b.ts_epoch-a.ts_epoch, ts_asc:(a,b)=>a.ts_epoch-b.ts_epoch, name_asc:(a,b)=>(a.cust||'').localeCompare(b.cust||''), name_desc:(a,b)=>(b.cust||'').localeCompare(a.cust||'') }[order] || ((a,b)=>b.ts_epoch-a.ts_epoch); rows=rows.sort(cmp); return {items:rows.slice((page-1)*size, page*size), total:rows.length}; }
async function render(page=1, kw={}){ const size=10; const {items,total}=await loadAll(page,size,kw); const pages=Math.max(1,Math.ceil(total/size)); $tbody.innerHTML = items.map((r,i)=>`<tr data-precise="${r.save_precise_diagnosis==='ì˜ˆ'?'Y':'N'}"><td>${(page-1)*size+i+1}</td><td>${r.ts}</td><td>${r.cust}</td><td>${r.phone}</td><td>${r.email}</td><td>${r.collect_id_masked||''}</td><td>${badge(r.safety_recommendation||r.safe_status)}</td><td>${badge(r.save_status)}</td><td>${badge(r.rent_want==='Y'?'í¬ë§':'-')}</td><td>${badge(r.collect_mode==='planner'?'íŒŒì›Œí”Œë˜ë„ˆ':'ê³ ì§€ì„œ ì œê³µ')}</td><td>${badge(r.bill_status)}</td></tr>`).join(''); $paging.innerHTML = Array.from({length:pages}, (_,i)=>`<a href="#" data-pg="${i+1}" class="${i+1===page?'active':''}">${i+1}</a>`).join(''); $paging.querySelectorAll('a').forEach(a=>a.addEventListener('click',(e)=>{e.preventDefault();render(+a.dataset.pg,kw);})); const only=(document.getElementById('onlyPrecise')||{}).checked; if(only){ $tbody.querySelectorAll('tr').forEach(tr=>{ if(tr.dataset.precise!=='Y') tr.style.display='none'; }); } }

// ì œì¶œ ì²˜ë¦¬
if($form){ $form.addEventListener('submit', async (e)=>{ e.preventDefault(); const fd=new FormData($form); // ëª¨ë“œë³„ í•„ìˆ˜
 const mode=fd.get('collect_mode')||'planner'; if(mode==='planner'){ if(!(fd.get('planner_id')||'').trim() || !(fd.get('planner_pw')||'').trim()){ alert('íŒŒì›Œí”Œë˜ë„ˆ ID/ì„ì‹œPWë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.'); return; } if(fd.get('planner_consent')!=="Y"){ alert('ë³´ì•ˆ ë™ì˜ì— ì²´í¬í•´ ì£¼ì„¸ìš”.'); return; } }
 if(fd.get('consent_consult')!=="Y" || fd.get('consent_privacy')!=="Y"){ alert('ë™ì˜ í•­ëª©ì— ì²´í¬í•´ ì£¼ì„¸ìš”.'); return; }
 // ì•ˆì „ ì˜ˆ ì¹´ìš´íŠ¸(ë„ì…ìš”êµ¬ ìë™íŒì •)
 const safeYes=['safe_visit_check','safe_remote_check','safe_all_breakers_check','safe_measured_month','safe_issue_trip','safe_issue_overload','safe_issue_unbalance','safe_issue_harmonics'].filter(n=>fd.get(n)==='ì˜ˆ').length;
 const recommendation = (safeYes<=4)?'ë„ì…ìš”êµ¬':'ê´€ì°°ì¤‘';
 const saveYes=['save_peak_known','save_simul_analysis'].filter(n=>fd.get(n)==='ì˜ˆ').length;
 const pid=(fd.get('planner_id')||'').trim(); const maskedId= pid? pid.replace(/.(?=.{2})/g,'*') : '';
 const row={ ts:new Date().toLocaleString(), ts_epoch:Date.now(), cust:fd.get('cust')||'', phone:fd.get('phone')||'', email:fd.get('email')||'', collect_mode:mode, collect_id_masked:maskedId, safety_recommendation:recommendation, safe_status: safeYes>=2?'ê¸°ì´ˆ ì •ë³´ í™•ë³´':'ì¶”ê°€ í™•ì¸ í•„ìš”', save_status: saveYes>=1 ? (fd.get('save_goal_pct')?`ëª©í‘œ ${fd.get('save_goal_pct')}%`:'ê´€ì‹¬ ìˆìŒ') : 'ì§„ë‹¨ í•„ìš”', bill_status: mode==='planner' ? (maskedId?`íŒŒì›Œí”Œë˜ë„ˆ(${maskedId})`:'íŒŒì›Œí”Œë˜ë„ˆ') : 'ê³ ì§€ì„œ ì œê³µ', safe_measured_month:fd.get('safe_measured_month')||'', safe_issue_trip:fd.get('safe_issue_trip')||'', safe_issue_overload:fd.get('safe_issue_overload')||'', safe_issue_unbalance:fd.get('safe_issue_unbalance')||'', safe_issue_harmonics:fd.get('safe_issue_harmonics')||'', save_peak_known:fd.get('save_peak_known')||'', save_simul_analysis:fd.get('save_simul_analysis')||'', save_goal_pct:fd.get('save_goal_pct')||'', save_precise_diagnosis:fd.get('save_precise_diagnosis')||'', consent_consult:fd.get('consent_consult')||'', consent_privacy:fd.get('consent_privacy')||'', rent_want:fd.get('rent_want')||'' };
 const rows=lsLoad(); rows.unshift(row); lsSave(rows); alert('ì œì¶œ ì™„ë£Œ! ì„¤ë¬¸ ë¦¬ìŠ¤íŠ¸ í™”ë©´ì—ì„œ í™•ì¸í•˜ì„¸ìš”.'); $form.reset(); show('list'); render(1); }); }

// íˆ´ë°” ì´ë²¤íŠ¸
const $fBtn=document.getElementById('btnFilter'); const $sort=document.getElementById('sortOrder'); const $only=document.getElementById('onlyPrecise');
if($fBtn){ $fBtn.addEventListener('click',()=>{ const kw={ cust:(document.getElementById('f_cust')||{}).value||'', phone:(document.getElementById('f_phone')||{}).value||'' }; render(1,kw); }); }
if($sort){ $sort.addEventListener('change', ()=>{ const kw={ cust:(document.getElementById('f_cust')||{}).value||'', phone:(document.getElementById('f_phone')||{}).value||'' }; render(1,kw); }); }
if($only){ const saved = localStorage.getItem('only_precise')==='1'; if(saved){ $only.checked=true; } $only.addEventListener('change', ()=>{ localStorage.setItem('only_precise', $only.checked?'1':'0'); const kw={ cust:(document.getElementById('f_cust')||{}).value||'', phone:(document.getElementById('f_phone')||{}).value||'' }; render(1,kw); }); }

// CSV/XLSX ë‚´ë³´ë‚´ê¸°
function toCSV(rows){ const header=['ts','cust','phone','email','safe_status','save_status','rent_want','save_precise_diagnosis','collect_mode','bill_status','safety_recommendation']; const esc=v=>(''+(v??'')).replaceAll('"','""'); const lines=[header.join(',')].concat(rows.map(r=>header.map(k=>`"${esc(r[k])}"`).join(','))); return lines.join('\r\n'); }
function exportRows(){ const kw={ cust:(document.getElementById('f_cust')||{}).value||'', phone:(document.getElementById('f_phone')||{}).value||'' }; const only=(document.getElementById('onlyPrecise')||{}).checked; let rows=lsLoad().filter(r=>(!kw.cust||r.cust.includes(kw.cust)) && (!kw.phone||r.phone.includes(kw.phone))); if(only){ rows=rows.filter(r=>r.save_precise_diagnosis==='ì˜ˆ'); } return rows; }
const $btnCsv=document.getElementById('btnCsv'); const $btnXlsx=document.getElementById('btnXlsx');
function download(filename, text){ const blob=new Blob([text],{type:'text/csv;charset=utf-8'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=filename; a.click(); setTimeout(()=>URL.revokeObjectURL(a.href),500); }
if($btnCsv){ $btnCsv.addEventListener('click', ()=>{ download('survey_export.csv', toCSV(exportRows())); }); }
if($btnXlsx){ $btnXlsx.addEventListener('click', ()=>{ download('survey_export.xlsx', toCSV(exportRows())); }); }

// ì ˆê°ì‚¬ë¡€ ëª¨ë‹¬ ìƒì„¸ë³´ê¸°
function openCaseModal(card){
  if(!card) return;
  const title=card.dataset.title||'ì‚¬ë¡€';
  const savings=card.dataset.savings||'';
  const points=card.dataset.points||'';
  const notes=card.dataset.notes||'';
  const before=card.dataset.before||'';
  const after=card.dataset.after||'';
  const modal=document.createElement('div');
  modal.className='modal-overlay';
  modal.innerHTML=`<div class="modal" role="dialog" aria-label="ì ˆê°ì‚¬ë¡€ ìƒì„¸">
      <h3>â­ ${title}</h3>
      <p style="margin:6px 0 10px;">${savings}</p>
      <table style="width:100%;text-align:left;border-collapse:collapse;font-size:14px;margin:8px 0 12px;">
        <tr><th style="padding:6px;border-bottom:1px solid #eee;width:34%">í•µì‹¬ ì¡°ì¹˜</th><td style="padding:6px;border-bottom:1px solid #eee;">${points}</td></tr>
        <tr><th style="padding:6px;border-bottom:1px solid #eee;">ë¹„ê³ </th><td style="padding:6px;border-bottom:1px solid #eee;">${notes}</td></tr>
        <tr><th style="padding:6px;border-bottom:1px solid #eee;">ë„ì… ì „</th><td style="padding:6px;border-bottom:1px solid #eee;">${before}</td></tr>
        <tr><th style="padding:6px;">ë„ì… í›„</th><td style="padding:6px;">${after}</td></tr>
      </table>
      <div style="display:flex;gap:8px;justify-content:flex-end;">
        <button class="btn secondary" onclick="this.closest('.modal-overlay').remove()">ë‹«ê¸°</button>
      </div>
    </div>`;
  document.body.appendChild(modal);
}
// ì¹´ë“œ í´ë¦­ ë°”ì¸ë”©(ìµœì´ˆ 1íšŒ)
(function bindCaseCards(){
  document.querySelectorAll('.case-card').forEach(card=>{
    card.style.cursor='pointer';
    if(!card.dataset.bound){ card.addEventListener('click',()=>openCaseModal(card)); card.dataset.bound='1'; }
  });
})();

// === Dark Mode Toggle ===
(function initTheme(){
  const saved=localStorage.getItem('theme')||'light';
  if(saved==='dark') document.body.setAttribute('data-theme','dark');
  const btn=document.getElementById('toggleDark');
  if(btn){ btn.addEventListener('click',()=>{
    const cur=document.body.getAttribute('data-theme')==='dark'?'dark':'light';
    const next= cur==='dark'?'light':'dark';
    document.body.setAttribute('data-theme', next==='dark'?'dark':'');
    localStorage.setItem('theme', next);
    btn.textContent = next==='dark'?'ğŸŒ Light':'ğŸŒ“ Dark';
  });
    btn.textContent = (saved==='dark')?'ğŸŒ Light':'ğŸŒ“ Dark';
  }
})();

// ì´ˆê¸° ë Œë”
render(1);

// ===== ìê°€ í…ŒìŠ¤íŠ¸ =====
(function selfTest(){ try{
  console.assert(document.querySelectorAll('#view-list').length===1,'[TEST] view-list 1ê°œ');
  console.assert(document.getElementById('page-safety')&&document.getElementById('page-peak')&&document.getElementById('page-saving')&&document.getElementById('page-cases'),'[TEST] ì„œë¸Œí˜ì´ì§€ ì¡´ì¬');
  console.assert(document.querySelectorAll('.subtabs2 .subtab2').length>=3,'[TEST] ì„œë¸Œíƒ­ ì¡´ì¬');
  console.assert(document.getElementById('onlyPrecise'),'[TEST] ì •ë°€ì§„ë‹¨=ì˜ˆë§Œ ì²´í¬ë°•ìŠ¤ ì¡´ì¬');
} catch(e){ console.warn('SELFTEST:', e); }})();
</script>
</body>
</html>
